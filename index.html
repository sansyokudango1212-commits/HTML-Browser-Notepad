<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <title>Notepad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Noto+Serif+JP&family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff; --text: #333; --ui-bg: rgba(255, 255, 255, 0.5);
      --hover: rgba(0,0,0,0.05); --dim: #888; --radius: 25px;
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg: #121212; --text: #e0e0e0; --ui-bg: rgba(40, 40, 40, 0.5); --hover: rgba(255,255,255,0.08); }
      select { background: #333; color: #fff; border: none; }
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
    }
    .glass {
      background: var(--ui-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2); z-index: 10;
    }
    header, #options, footer { border-radius: var(--radius); margin: 12px auto; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    header { padding: 6px 12px; display: flex; gap: 8px; width: fit-content; font-size: 12px; }
    header span { cursor: pointer; padding: 4px 12px; border-radius: 20px; }
    header span:hover { background: var(--hover); }
    #options {
      position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
      width: 280px; padding: 0 20px; overflow: hidden; max-height: 0; opacity: 0;
      pointer-events: none;
    }
    #options.show { max-height: 200px; padding: 12px 20px; opacity: 1; pointer-events: auto; }
    #options div { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
    .label { width: 60px; color: var(--dim); font-size: 11px; }
    textarea {
      flex: 1; border: none; outline: none; padding: 60px 30px; margin-top: -60px;
      background: transparent; color: inherit; line-height: 1.8; font-size: 18px; resize: none;
    }
    footer {
      position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
      padding: 8px 24px; font-size: 12px; color: var(--dim); display: flex; gap: 20px;
    }
    footer.hidden { transform: translate(-50%, 50px); opacity: 0; pointer-events: none; }
    #backdrop { position: fixed; inset: 0; z-index: 9; display: none; }
    #backdrop.show { display: block; }
    @media (max-width: 768px) {
      #b-info { display: none; }
    }
  </style>
</head>
<body>

  <header class="glass">
    <span onclick="act('new')">新規</span>
    <span onclick="act('open')">開く</span>
    <span onclick="act('save')">保存</span>
    <span onclick="act('toggle')">設定</span>
  </header>

  <div id="options" class="glass">
    <div><span class="label">Font</span><select id="fSel"></select></div>
    <div><span class="label">Size</span><select id="sSel"></select></div>
    <div style="font-size: 10px; color: var(--dim); justify-content: center; border-top: 1px solid rgba(128,128,128,0.1); padding-top: 5px;">
      Build TH202601220046FUX · Version 5.3.1
    </div>
  </div>

  <div id="backdrop" onclick="act('toggle')"></div>
  <textarea id="edit" spellcheck="false"></textarea>

  <footer id="ft" class="glass">
    <span id="b-info">Browser</span>
    <span id="f-info">memo.txt · 0 文字</span>
  </footer>

  <input type="file" id="fileInput" hidden accept=".txt">

  <script>
    function getBrowserName() {
      const uaStr = navigator.userAgent.toLowerCase();
      if (uaStr.includes('edge')) return 'Edge';
      if (uaStr.includes('opr') || uaStr.includes('opera')) return 'Opera';
      if (uaStr.includes('firefox')) return 'Firefox';
      if (uaStr.includes('chrome') && !uaStr.includes('chromium')) return 'Chrome';
      if (uaStr.includes('safari')) return 'Safari';
      return 'Browser';
    }
    const detectedBrowser = getBrowserName();

    const $ = id => document.getElementById(id);
    const edit = $('edit'), fSel = $('fSel'), sSel = $('sSel'), opt = $('options'), bd = $('backdrop'), ft = $('ft');
    let curFile = 'memo.txt';
    let hideTimer = null;

    window.act = function(type) {
      switch(type) {
        case 'new':
          if (confirm("内容を削除しますか？")) edit.value = "";
          break;
        case 'open':
          $('fileInput').click();
          break;
        case 'save': {
          const a = document.createElement('a');
          const blob = new Blob([edit.value]);
          const url = URL.createObjectURL(blob);
          a.href = url;
          a.download = curFile;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          setTimeout(() => {
            URL.revokeObjectURL(url);
          }, 100);
          break;
        }
        case 'toggle': {
          const isShow = opt.classList.toggle('show');
          bd.classList.toggle('show', isShow);
          break;
        }
      }
      update();
    };

    function apply() {
      edit.style.fontFamily = fSel.value;
      edit.style.fontSize = sSel.value + 'px';
    }

    function update() {
      $('f-info').textContent = `${curFile} · ${edit.value.length} 文字`;
      
      // 5秒タイマーのリセットと開始
      clearTimeout(hideTimer);
      
      // 基本の隠す判定：最下部付近に文字があるかどうか
      const isBottom = edit.scrollHeight - (edit.scrollTop + edit.clientHeight) < 50;
      const shouldHide = edit.value.length > 0 && isBottom;

      if (shouldHide) {
        ft.classList.add('hidden');
        // 1秒間操作がなければ表示するタイマー
        hideTimer = setTimeout(() => {
          ft.classList.remove('hidden');
        }, 1000);
      } else {
        ft.classList.remove('hidden');
      }
    }

    const fonts = ['Arial', 'Noto Serif JP', 'Zen Maru Gothic', 'Dela Gothic One'];
    fonts.forEach(f => fSel.add(new Option(f, f)));
    for(let i=12; i<=80; i+=2) sSel.add(new Option(`${i}px`, `${i}`));
    sSel.value = 18;

    edit.oninput = update;
    edit.onscroll = update;
    // クリックやタップなどの操作でもタイマーをリセット
    edit.onclick = update;
    fSel.onchange = apply;
    sSel.onchange = apply;

    $('fileInput').onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      curFile = file.name;
      const reader = new FileReader();
      reader.onload = () => { edit.value = reader.result; update(); };
      reader.readAsText(file);
    };

    $('b-info').textContent = detectedBrowser;
    edit.placeholder = detectedBrowser + " >";

    apply();
    update();
  </script>
</body>
</html>

